<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å¤šè¯­è¨€æœ¬åœŸåŒ–ç¿»è¯‘</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f8f9fa;
    margin: 0; padding: 20px;
  }
  h1 { color: #333; }
  label { font-weight: bold; margin-top: 15px; display: block; }
  textarea { width: 100%; height: 100px; padding: 10px; margin-top: 5px; }
  select, button { padding: 8px; margin-top: 5px; }
  ul {
    list-style: none; padding: 0; margin: 10px 0;
    display: flex; flex-wrap: wrap; gap: 8px;
  }
  ul li {
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 6px 10px;
    cursor: grab;
  }
  ul li.dragging {
    opacity: 0.5;
    background: #e0e0e0;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background: white;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: left;
  }
</style>
</head>
<body>

<h1>ğŸŒ å¤šè¯­è¨€æœ¬åœŸåŒ–ç¿»è¯‘</h1>

<label>è¾“å…¥è¦ç¿»è¯‘çš„è‹±æ–‡è¯æ±‡ï¼ˆå¤šè¡Œï¼‰ï¼š</label>
<textarea id="sourceText" placeholder="æ¯è¡Œä¸€ä¸ªè¯æˆ–çŸ­è¯­"></textarea>

<label>æ‹–åŠ¨ä¸‹æ–¹æ ‡ç­¾è°ƒæ•´è¯­è¨€é¡ºåºï¼š</label>
<ul id="headerList">
  <li draggable="true" data-code="zh">ç®€ä½“ä¸­æ–‡</li>
  <li draggable="true" data-code="ja">æ—¥è¯­</li>
  <li draggable="true" data-code="de">å¾·è¯­</li>
  <li draggable="true" data-code="pt">è‘¡è„ç‰™è¯­</li>
  <li draggable="true" data-code="es">è¥¿ç­ç‰™è¯­</li>
  <li draggable="true" data-code="fr">æ³•è¯­</li>
  <li draggable="true" data-code="ko">éŸ©è¯­</li>
  <li draggable="true" data-code="tw">ç¹ä½“ä¸­æ–‡</li>
  <li draggable="true" data-code="vi">è¶Šå—è¯­</li>
</ul>

<button onclick="translate()">ç¿»è¯‘</button>

<div id="output"></div>

<script>
const list = document.getElementById('headerList');
let dragItem = null;

// æ‹–æ‹½é€»è¾‘
list.addEventListener('dragstart', e => {
  dragItem = e.target;
  e.target.classList.add('dragging');
});
list.addEventListener('dragend', e => {
  e.target.classList.remove('dragging');
  dragItem = null;
});
list.addEventListener('dragover', e => {
  e.preventDefault();
  const target = e.target.closest('li');
  if (target && target !== dragItem) {
    const rect = target.getBoundingClientRect();
    const next = (e.clientY - rect.top) / (rect.bottom - rect.top) > 0.5;
    list.insertBefore(dragItem, next ? target.nextSibling : target);
  }
});

function getHeaderOrder() {
  return Array.from(list.querySelectorAll('li')).map(li => li.dataset.code);
}

async function translate() {
  const text = document.getElementById("sourceText").value.trim();
  const headerOrder = getHeaderOrder();

  if (!text) {
    alert("è¯·è¾“å…¥è¦ç¿»è¯‘çš„è‹±æ–‡è¯æ±‡");
    return;
  }

  document.getElementById("output").innerHTML = "<p>ç¿»è¯‘ä¸­...</p>";

  try {
    const res = await fetch("https://localize-proxy.ne0s0u1-pd.workers.dev", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text, headerOrder })
    });

    const data = await res.json();
    if (!data.table) {
      document.getElementById("output").innerHTML = "<p>ç¿»è¯‘å¤±è´¥</p>";
      return;
    }

    // è§£æ TSV
    const rows = data.table.trim().split("\n").map(r => r.split("\t"));
    let html = "<table><thead><tr>";
    rows[0].forEach(col => html += `<th>${col}</th>`);
    html += "</tr></thead><tbody>";
    rows.slice(1).forEach(row => {
      html += "<tr>" + row.map(cell => `<td>${cell}</td>`).join("") + "</tr>";
    });
    html += "</tbody></table>";

    document.getElementById("output").innerHTML = html;

  } catch (err) {
    document.getElementById("output").innerHTML = "<p>è¯·æ±‚å¤±è´¥ï¼š" + err.message + "</p>";
  }
}
</script>

</body>
</html>
