<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>多语言本土化翻译</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f8f9fa;
    margin: 0; padding: 20px;
  }
  h1 { color: #333; }
  label { font-weight: bold; margin-top: 15px; display: block; }
  textarea { width: 100%; height: 100px; padding: 10px; margin-top: 5px; }
  select, button { padding: 8px; margin-top: 5px; }
  ul {
    list-style: none; padding: 0; margin: 10px 0;
    display: flex; flex-wrap: wrap; gap: 8px;
  }
  ul li {
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 6px 10px;
    cursor: grab;
  }
  ul li.dragging {
    opacity: 0.5;
    background: #e0e0e0;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background: white;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: left;
  }
</style>
</head>
<body>

<h1>🌏 多语言本土化翻译</h1>

<label>输入要翻译的英文词汇（多行）：</label>
<textarea id="sourceText" placeholder="每行一个词或短语"></textarea>

<label>拖动下方标签调整语言顺序：</label>
<ul id="headerList">
  <li draggable="true" data-code="zh">简体中文</li>
  <li draggable="true" data-code="ja">日语</li>
  <li draggable="true" data-code="de">德语</li>
  <li draggable="true" data-code="pt">葡萄牙语</li>
  <li draggable="true" data-code="es">西班牙语</li>
  <li draggable="true" data-code="fr">法语</li>
  <li draggable="true" data-code="ko">韩语</li>
  <li draggable="true" data-code="tw">繁体中文</li>
  <li draggable="true" data-code="vi">越南语</li>
</ul>

<button onclick="translate()">翻译</button>

<div id="output"></div>

<script>
const list = document.getElementById('headerList');
let dragItem = null;

// 拖拽逻辑
list.addEventListener('dragstart', e => {
  dragItem = e.target;
  e.target.classList.add('dragging');
});
list.addEventListener('dragend', e => {
  e.target.classList.remove('dragging');
  dragItem = null;
});
list.addEventListener('dragover', e => {
  e.preventDefault();
  const target = e.target.closest('li');
  if (target && target !== dragItem) {
    const rect = target.getBoundingClientRect();
    const next = (e.clientY - rect.top) / (rect.bottom - rect.top) > 0.5;
    list.insertBefore(dragItem, next ? target.nextSibling : target);
  }
});

function getHeaderOrder() {
  return Array.from(list.querySelectorAll('li')).map(li => li.dataset.code);
}

async function translate() {
  const text = document.getElementById("sourceText").value.trim();
  const headerOrder = getHeaderOrder();

  if (!text) {
    alert("请输入要翻译的英文词汇");
    return;
  }

  document.getElementById("output").innerHTML = "<p>翻译中...</p>";

  try {
    const res = await fetch("https://localize-proxy.ne0s0u1-pd.workers.dev", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text, headerOrder })
    });

    const data = await res.json();
    if (!data.table) {
      document.getElementById("output").innerHTML = "<p>翻译失败</p>";
      return;
    }

    // 解析 TSV
    const rows = data.table.trim().split("\n").map(r => r.split("\t"));
    let html = "<table><thead><tr>";
    rows[0].forEach(col => html += `<th>${col}</th>`);
    html += "</tr></thead><tbody>";
    rows.slice(1).forEach(row => {
      html += "<tr>" + row.map(cell => `<td>${cell}</td>`).join("") + "</tr>";
    });
    html += "</tbody></table>";

    document.getElementById("output").innerHTML = html;

  } catch (err) {
    document.getElementById("output").innerHTML = "<p>请求失败：" + err.message + "</p>";
  }
}
</script>

</body>
</html>
