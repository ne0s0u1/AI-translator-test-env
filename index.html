<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>多语言本土化翻译</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: #f4f6f9;
    margin: 0; padding: 30px;
    display: flex;
    justify-content: center;
  }
  .container {
    max-width: 900px;
    width: 100%;
    background: #fff;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  }
  h1 {
    display: flex; align-items: center;
    font-size: 1.8em; color: #333;
    margin-bottom: 20px;
  }
  h1::before {
    content: "🌏";
    margin-right: 10px;
  }
  label { font-weight: bold; display: block; margin-top: 15px; color: #555; }
  textarea {
    width: 100%; height: 120px; padding: 12px;
    border: 1px solid #ccc; border-radius: 8px;
    margin-top: 8px; font-size: 14px; resize: vertical;
    background: #fafafa;
  }
  ul {
    list-style: none; padding: 0; margin: 12px 0;
    display: flex; flex-wrap: wrap; gap: 10px;
  }
  ul li {
    background: #f0f3f7;
    border: 1px solid #d0d7de;
    border-radius: 20px;
    padding: 6px 14px;
    cursor: grab;
    font-size: 14px;
    transition: background 0.2s;
  }
  ul li:hover {
    background: #e2e6eb;
  }
  ul li.dragging {
    opacity: 0.5;
    background: #cfd6de;
  }
  button {
    background: #4e73df;
    color: white; border: none;
    padding: 10px 18px;
    border-radius: 8px;
    font-size: 15px;
    margin-top: 10px;
    cursor: pointer;
    transition: background 0.2s;
  }
  button:hover {
    background: #3759c7;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 18px;
    background: white;
    border-radius: 8px;
    overflow: hidden;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
    font-size: 14px;
  }
  th {
    background: #f8f9fc;
    font-weight: bold;
  }
</style>
</head>
<body>

<div class="container">
  <h1>多语言本土化翻译</h1>

  <label>输入要翻译的英文词汇（多行）：</label>
  <textarea id="sourceText" placeholder="每行一个词或短语"></textarea>

  <label>拖动下方标签调整语言顺序：</label>
  <ul id="headerList">
    <li draggable="true" data-code="zh">简体中文</li>
    <li draggable="true" data-code="de">德语</li>
    <li draggable="true" data-code="pt">葡萄牙语</li>
    <li draggable="true" data-code="es">西班牙语</li>
    <li draggable="true" data-code="fr">法语</li>
    <li draggable="true" data-code="ko">韩语</li>
    <li draggable="true" data-code="ja">日语</li>
    <li draggable="true" data-code="tw">繁体中文</li>
    <li draggable="true" data-code="vi">越南语</li>
  </ul>

  <button onclick="translate()">翻译</button>

  <div id="output"></div>
</div>

<script>
const list = document.getElementById('headerList');
let dragItem = null;

list.addEventListener('dragstart', e => {
  dragItem = e.target;
  e.target.classList.add('dragging');
});
list.addEventListener('dragend', e => {
  e.target.classList.remove('dragging');
  dragItem = null;
});
list.addEventListener('dragover', e => {
  e.preventDefault();
  const target = e.target.closest('li');
  if (target && target !== dragItem) {
    const rect = target.getBoundingClientRect();
    const next = (e.clientY - rect.top) / (rect.bottom - rect.top) > 0.5;
    list.insertBefore(dragItem, next ? target.nextSibling : target);
  }
});

function getHeaderOrder() {
  return Array.from(list.querySelectorAll('li')).map(li => li.dataset.code);
}

async function translate() {
  const text = document.getElementById("sourceText").value.trim();
  const headerOrder = getHeaderOrder();

  if (!text) {
    alert("请输入要翻译的英文词汇");
    return;
  }

  document.getElementById("output").innerHTML = "<p>翻译中...</p>";

  try {
    const res = await fetch("https://localize-proxy.ne0s0u1-pd.workers.dev", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text, headerOrder })
    });

    const data = await res.json();
    if (!data.table) {
      document.getElementById("output").innerHTML = "<p>翻译失败</p>";
      return;
    }

    const rows = data.table.trim().split("\n").map(r => r.split("\t"));
    let html = "<table><thead><tr>";
    rows[0].forEach(col => html += `<th>${col}</th>`);
    html += "</tr></thead><tbody>";
    rows.slice(1).forEach(row => {
      html += "<tr>" + row.map(cell => `<td>${cell}</td>`).join("") + "</tr>";
    });
    html += "</tbody></table>";

    document.getElementById("output").innerHTML = html;

  } catch (err) {
    document.getElementById("output").innerHTML = "<p>请求失败：" + err.message + "</p>";
  }
}
</script>

</body>
</html>
